# PocketBase 钩子脚本管理界面 UI/UX 设计

## 1. 设计目标

为 PocketBase 钩子脚本管理系统设计一个直观、高效且易于使用的用户界面，使管理员能够轻松地创建、编辑、测试和管理钩子脚本。界面设计应当符合 PocketBase 现有的设计语言和用户体验模式，确保与整体管理界面的一致性。

## 2. 用户角色

- **超级管理员**：拥有创建、编辑、删除和管理所有钩子脚本的权限
- **普通管理员**：仅能查看钩子脚本（可选，取决于权限设计）

## 3. 界面结构

### 3.1 导航与位置

在 PocketBase 管理界面的主导航中添加"钩子脚本"（Hook Scripts）菜单项，位于"设置"菜单项附近，表明这是一个系统级配置功能。

![导航菜单](https://placeholder-for-navigation-menu.png)

### 3.2 主要页面

1. **钩子脚本列表页**：显示所有钩子脚本的概览
2. **钩子脚本编辑页**：创建或编辑单个钩子脚本
3. **钩子脚本版本历史页**：查看和管理脚本的历史版本
4. **钩子脚本测试页**：测试脚本的执行效果

## 4. 详细界面设计

### 4.1 钩子脚本列表页

![钩子脚本列表页](https://placeholder-for-hooks-list-page.png)

#### 4.1.1 页面组件

- **页面标题**："钩子脚本" (Hook Scripts)
- **创建按钮**：右上角的 "+ 新建钩子脚本" 按钮
- **筛选器**：
  - 按类型筛选（记录、集合、API、系统）
  - 按事件筛选（创建、更新、删除等）
  - 按集合筛选（仅适用于记录和集合类型的钩子）
  - 按状态筛选（启用/禁用）
- **搜索框**：按名称或描述搜索脚本
- **脚本列表表格**：
  - 名称列
  - 类型列
  - 事件列
  - 集合列（如适用）
  - 状态列（启用/禁用）
  - 执行顺序列
  - 最后更新时间列
  - 操作列（编辑、启用/禁用、删除、查看版本历史）

#### 4.1.2 交互设计

- 点击表格行可以展开显示脚本描述和简短的代码预览
- 点击编辑按钮打开编辑页面
- 点击启用/禁用按钮可以快速切换脚本状态
- 点击删除按钮显示确认对话框
- 点击版本历史按钮导航到版本历史页面
- 表格支持按列排序
- 支持拖放调整脚本执行顺序

### 4.2 钩子脚本编辑页

![钩子脚本编辑页](https://placeholder-for-hook-edit-page.png)

#### 4.2.1 页面组件

- **页面标题**："创建钩子脚本" 或 "编辑钩子脚本: [脚本名称]"
- **表单区域**：
  - 名称输入框（必填）
  - 描述输入框
  - 类型选择器（记录、集合、API、系统）
  - 事件选择器（根据所选类型动态变化）
  - 集合选择器（仅当类型为记录或集合时显示）
  - 执行顺序输入框（数字）
  - 启用/禁用开关
- **代码编辑器**：
  - 基于 Monaco Editor
  - JavaScript 语法高亮
  - 自动完成功能
  - 行号显示
  - 错误提示
  - 代码折叠
- **工具栏**：
  - 保存按钮
  - 测试按钮（仅在编辑现有脚本时显示）
  - 保存为新版本按钮（仅在编辑现有脚本时显示）
  - 取消按钮

#### 4.2.2 代码编辑器功能

- **语法高亮**：支持 JavaScript/TypeScript 语法高亮
- **自动完成**：
  - PocketBase API 方法和属性
  - 钩子事件对象属性和方法
  - JavaScript 标准库
- **代码片段**：常用钩子脚本模板
- **实时错误检查**：语法错误和潜在问题提示
- **格式化**：代码格式化功能

#### 4.2.3 交互设计

- 类型选择变化时，动态更新事件选择器的选项
- 类型选择为记录或集合时，显示集合选择器
- 保存前进行表单验证
- 测试按钮点击后，在弹出面板中显示测试结果
- 保存为新版本按钮点击后，弹出对话框输入版本说明

### 4.3 钩子脚本版本历史页

![钩子脚本版本历史页](https://placeholder-for-version-history-page.png)

#### 4.3.1 页面组件

- **页面标题**："[脚本名称] 版本历史"
- **返回按钮**：返回到脚本编辑页
- **版本列表**：
  - 版本号/ID
  - 创建时间
  - 创建者
  - 版本说明
  - 操作（查看、恢复、比较）

#### 4.3.2 版本比较视图

![版本比较视图](https://placeholder-for-version-compare-view.png)

- 并排显示两个版本的代码
- 高亮显示差异
- 可以选择任意两个版本进行比较

#### 4.3.3 交互设计

- 点击查看按钮显示该版本的完整代码
- 点击恢复按钮将脚本恢复到该版本，并创建新的版本记录
- 选择两个版本后，点击比较按钮显示版本比较视图

### 4.4 钩子脚本测试页/面板

![钩子脚本测试面板](https://placeholder-for-test-panel.png)

#### 4.4.1 组件

- **测试配置区域**：
  - 测试事件类型选择
  - 测试数据输入（JSON 编辑器）
  - 运行测试按钮
- **测试结果区域**：
  - 执行状态（成功/失败）
  - 执行时间
  - 控制台输出
  - 错误信息（如有）
  - 返回值或修改后的数据

#### 4.4.2 交互设计

- 根据脚本类型和事件，提供相应的测试数据模板
- 运行测试后实时显示结果
- 支持查看详细的执行日志
- 测试失败时高亮显示错误位置

## 5. 响应式设计

界面应当支持不同屏幕尺寸，特别是：

- **桌面**：完整功能，优化布局利用宽屏空间
- **平板**：调整布局，确保关键功能易于访问
- **移动设备**：简化视图，专注于查看功能，编辑功能可能受限

### 5.1 移动设计考虑

- 列表页使用卡片视图替代表格
- 编辑器在移动设备上可能只提供基本功能
- 使用抽屉菜单或底部工具栏优化导航

## 6. 可访问性设计

- 符合 WCAG 2.1 AA 级标准
- 键盘导航支持
- 屏幕阅读器兼容性
- 足够的颜色对比度
- 可调整的字体大小
- 焦点状态清晰可见

## 7. 状态和反馈

### 7.1 加载状态

- 列表加载时显示骨架屏或加载指示器
- 保存操作时显示进度指示器
- 长时间操作（如测试）时显示进度条

### 7.2 成功状态

- 保存成功时显示成功消息通知
- 测试成功时在测试面板中显示成功标志

### 7.3 错误状态

- 表单验证错误时在相应字段旁显示错误消息
- API 错误时显示错误通知，包含错误详情
- 脚本执行错误时在编辑器中高亮错误位置

## 8. 动画和过渡

- 页面切换时使用平滑过渡
- 列表项操作（如启用/禁用）时使用微妙的动画
- 面板展开/折叠时使用自然的动画
- 确保所有动画可以通过系统设置禁用（尊重用户的减少动画偏好）

## 9. 设计系统集成

### 9.1 颜色系统

使用 PocketBase 现有的颜色系统：

- 主色：用于主要按钮、链接和强调元素
- 成功色：用于成功状态和启用指示器
- 警告色：用于警告消息
- 错误色：用于错误消息和禁用指示器
- 中性色：用于背景、边框和次要文本

### 9.2 排版

遵循 PocketBase 现有的排版系统：

- 标题字体和大小
- 正文文本样式
- 标签和辅助文本样式

### 9.3 组件复用

尽可能复用 PocketBase 现有的 UI 组件：

- 按钮
- 表单控件
- 表格
- 卡片
- 通知
- 对话框

## 10. 用户体验考虑

### 10.1 初次使用体验

- 当没有脚本时，显示欢迎信息和创建第一个脚本的指导
- 提供示例脚本模板
- 考虑添加简短的教程或提示

### 10.2 高级用户体验

- 提供键盘快捷键
- 支持批量操作（如批量启用/禁用、删除）
- 允许导入/导出脚本

### 10.3 错误预防

- 删除操作需要确认
- 离开未保存的编辑页面时显示警告
- 自动保存草稿功能

## 11. 实现注意事项

### 11.1 前端技术

- 使用 Svelte 构建组件，与现有 PocketBase 前端保持一致
- 使用 Monaco Editor 作为代码编辑器
- 使用 CSS 变量实现主题一致性

### 11.2 性能考虑

- 代码编辑器懒加载
- 大型列表使用虚拟滚动
- 优化 API 请求，减少不必要的数据传输

## 12. 未来扩展

设计应当考虑未来可能的功能扩展：

- 脚本分类和标签
- 更高级的测试工具
- 脚本执行统计和性能监控
- 团队协作功能
- 与版本控制系统集成

## 13. 结论

本设计文档提供了 PocketBase 钩子脚本管理界面的详细 UI/UX 设计规范。通过遵循这些设计指南，我们可以创建一个直观、高效且与 PocketBase 整体设计语言一致的用户界面，使管理员能够轻松地管理钩子脚本。